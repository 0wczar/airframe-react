@import "~bootstrap/scss/functions";
@import "~bootstrap/scss/mixins/breakpoints";
@import "./../variables";

@mixin sidebar-scrollbar {
    &::-webkit-scrollbar {
        display: none;
        width: 0.25rem;
    }

    &::-webkit-scrollbar-track {
        background-color: $gray-100;
    }

    &::-webkit-scrollbar-thumb {
        background-color: $gray-300;
    }

    scrollbar-width: none;
}

.sidebar {
    position: fixed;
    top: 0;
    border-right: 1px solid $gray-300;
    box-shadow: 0 .125rem .25rem rgba($black, .035);
    left: 0;
    bottom: 0;
    z-index: 1031;

    display: flex;
    width: $sidebar-default-width;
    flex-direction: column;
    background: $sidebar-background;

    &__section {
        flex: 0 0 auto;
        padding: 1.5rem;

        &--fluid {
            flex: 1 1 auto;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;

            @include sidebar-scrollbar();
        }

        &--cover {
            padding: 0;
        }
    }

    &__close {
        display: none;

        > a {
            color: $gray-300;

            &:hover {
                color: $gray-500;
            }
        }
    }

    &__brand {
        color: $sidebar-brand-color;

        &:hover {
            color: $sidebar-brand-color;
        }
    }

    &__link {
        color: $sidebar-link-color;

        &:hover {
            color: $sidebar-link-color-hover;
            text-decoration: none;
        }

        &:active,
        &:focus {
            text-decoration: none;
        }

        &--muted {
            color: $sidebar-link-color-muted;
        }
    }

    &__show-slim {
        display: none;
    }

    // Allows to scroll multpile sections on mobile devices
    &__mobile-fluid {
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
        min-height: 0;

        @media (max-width: breakpoint-max('md', $grid-breakpoints)) {    
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            @include sidebar-scrollbar();

            .sidebar__section--fluid {
                flex: 1 0 auto;

                overflow-y: initial;
                -webkit-overflow-scrolling: unset;
            }
        }
    }

    // Transition Animations
    &--animations-enabled {
        &.sidebar--animate-slim--progress {
            .active > a {
                background-color: transparent !important;
                box-shadow: none !important;
                color: $sidebar-menu-color !important;
            }
    
            .sidebar-menu__entry__link::after,
            .sidebar-submenu__entry__link::after {
                opacity: 0;
            }
    
            .sidebar-menu .badge {
                opacity: 0;
            }
        }
    
        &.sidebar--animate-entry-complete {
            .sidebar__section {
                opacity: 1;
            }
        }
    
        .sidebar__section {
            opacity: 0;
        }
    
        .sidebar-menu__entry {
            &__link::after {
                transition: opacity 200ms ease-in;
            }
    
            &.active .sidebar-menu__entry__link {
                transition: background-color 200ms ease-in-out
                            box-shadow 200ms ease-in-out;
            }
        }
    
        .sidbear-menu .badge {
            transition: opacity 200ms ease-in-out;
        }
    
        /*
        &.sidebar--slim.sidebar--collapsed {
            // Slim Submenus
            .sidebar-menu__entry > .sidebar-submenu {
                display: block !important;
                opacity: 0;
                transform: translateY(-40px) scale(0.8);
                transition: opacity 200ms ease-in-out,
                            transform 200ms cubic-bezier(0.645, 0.045, 0.465, 1.305);
                transition-delay: 200ms;
            }
    
            .sidebar-menu__entry:hover > .sidebar-submenu {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        */
    }
}

// collapse to Slim Sidebar at >= LG
@media (min-width: breakpoint-min('lg', $grid-breakpoints)) {
    .sidebar--slim {
        &.sidebar--collapsed {
            width: $sidebar-slim-width;

            .sidebar__section:not(.sidebar__section--cover) {
                padding: 1rem;
                text-align: center;
            }

            .sidebar__show-slim {
                display: block;
            }

            .sidebar__hide-slim {
                display: none;
            }

            .sidebar__section--fluid {
                overflow-y: visible;
            }
        }
    }
    .sidebar:not(.sidebar--slim) {
        &.sidebar--collapsed {
            display: none;
        }
    }
}

// overlay and collapse with transform at < LG
@media (max-width: breakpoint-max('md', $grid-breakpoints)) {
    .sidebar {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        right: auto;
        touch-action: none;
        transform: translateZ(0);

        transition: transform $sidebar-overlay-transition;

        &--collapsed {
            transform: translateZ(0) translateX(-100%);
        }

        &--animations-disabled {
            transition: none;
        }

        &__close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: block;
        }

        &:not(.sidebar--collapsed) {
            box-shadow: 0px 0px 1rem 0px rgba($black, .15);
        }
    }
}
